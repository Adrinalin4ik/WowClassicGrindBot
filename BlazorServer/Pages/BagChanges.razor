@inject Core.IAddonReader addonReader
@inject Core.IBotController botController
@inject IJSRuntime JSRuntime
@using SharedLib
@using Core
@using Microsoft.AspNetCore.Html

<div class="card">
    <div class="card-header">
        Bag Changes
    </div>
    <div class="card-body">
        @foreach (var bagItem in NewItems)
        {
            <div class="animate__animated animate__backInUp">
                <BagItemComponent BagItem="bagItem" ShowChangesPrice="true" />
                <hr style="margin:2px" />
            </div>
        }
    </div>
</div>
@code {

    List<Core.BagItem> NewItems = new List<Core.BagItem>();

    MarkupString resultString = (MarkupString)"";

    protected override void OnInitialized()
    {
        addonReader.BagReader.DataChanged += (o, e) =>
        {
            this.NewItems = addonReader.BagReader.BagItems.Where(i => i.WasRecentlyUpdated).ToList();

            base.InvokeAsync(() => { try { StateHasChanged(); } catch { } });
        };
    }
}